# Exploit-Technique

- `Pwn Win Start`: https://www.youtube.com/watch?v=SwoN9aanH1E&list=PLZptvBlvUP8qLZRmbcEqc5LExliRb41iy
- `Binary Exploit Development Tutorial`: https://www.youtube.com/watch?v=hdlHPv48gNY&list=PLt9cUwGw6CYEmxx_3z1d-uT9zdEd58yOq

- `Target start WinRar`:

  - https://github.com/b1tg/CVE-2023-38831-winrar-exploit
  - https://github.com/ignis-sec/CVE-2023-38831-RaRCE

- `FuzzySecurity`: https://fuzzysecurity.com/tutorials

- https://www.youtube.com/watch?v=7ySes8NCt78

- https://gitbook.seguranca-informatica.pt/cve-and-exploits/privilege-escalation

## Shellcode Windows

- Tạo shellcode trên Windows, shellcode windows phải thực hiện:

  - load the DLL into memory
  - find the required functions directly from the shellcode.

- Các bước thực hiện:

  - 1.  Lấy địa chỉ cơ sở kernel32.dll
  - 2.  Tìm địa chỉ hàm GetProcAddress
  - 3.  Sử dụng GetProcAddress để tìm địa chỉ của hàm LoadLibrary
  - 4.  Sử dụng LoadLibrary để tải một DLL (chẳng hạn như user32.dll)
  - 5.  Sử dụng GetProcAddress để tìm địa chỉ của một hàm (chẳng hạn như MessageBox)
  - 6.  Chỉ định các tham số chức năng.
  - 7.  Gọi hàm.

- Lưu ý:
  - 1.  Hiệu số trực tiếp (sử dụng push chuỗi lên stack để xử lý).
  - 2.  Địa chỉ của các chức năng
    - Trên HĐH Windows thì dùng GetProcAddress vf LoadLibrary từ WindowsAPI.
    - HĐH Linux dùng các syscall.
  - 3.  Tránh Null Byte: xor register, register
    - kernel32.dll và user32.dll (tương đương với libc.so)
    - PEB (Process Enviroment Block)
    - Console API Functions

## Overview CVE

**[+]** `Writeup CVE`:

- **CVE:** https://hackmd.io/@HuyTrnTrng1 .
- **Gitlab:** https://gitlab.com/trantronghuy0706 .

**[+]** `Bounty Platform`:

- [Microsoft Security Response Center](https://www.microsoft.com/en-us/msrc/bounty)
- [Google bounty](https://google.github.io/security-research/kernelctf/rules.html)
- Zero Day Rewards
  - iDefense
  - TippingPoint-ZDI
  - Zerodium
  - Zer0con, TyphoonCon

**[+]** `Event Hacking`:

- **Tianfucup**
- **Pwn2Own**

**[+]** `Security Team or Lab`

- Tencent | Keen | Security Research
- Tencent Keen Labs | 360Vulscan của Qihoo360

- `StarLAB`: https://github.com/star-sg/CVE

- Application:

  - IOT (Router, Camera,...)
  - Open source (exim, linux kernel,...)
  - Browser (chrome, firefox, safari,...)
  - Hypervisor
  - Windows (Kernel, Software)
  - Virtualization (Virtualbox, VMware, ...)

## Report Template

- `1.` Overview về thành phần có lỗi.
- `2.` Mô tả về lỗi

  - Loại lỗi
  - Mã giả /đoạn code lỗi.
  - Chỉ ra điều kiện mà đoạn code xử lý lỗi.
  - Cách giao tiếp.
  - Stacktrace
  - Thành phần key trong poc để trigger code path
  - Optional: context lúc lỗi.

- `3.` Exploitation.

  - Tiềm năng của lỗi (Overflow bao nhiêu byte, use after free trên chunk bao nhiêu byte ntn trên vùng heap/pool/stack thế nào , lỗi logic dẫn tới gì).
  - Hướng khai thác lỗi (Dùng pool fengshui thì nêu rõ dùng object gì , sau đó làm gì xử lý trạng thái pool thế nào, bypass các mitigation thế nào, xử lý logic lỗi dẫn tới load một dll dưới quyền system, dll cần phải thế nào).
  - Các vấn đề của hướng khai thác lỗi hiện tại, hướng xử lý (vd hardcode offset các địa chỉ gadget thì làm sao để stable nó).

- `4.` Affect range

  - Lỗi ảnh hưởng từ phiên bản nào, build nào.
  - Lỗi xuất hiện từ bản (commit) nào ( Xác định version + ngày release).

- `5.` The patch.

  - Lỗi được vá ( mitigate ) như thế nào.
  - Bản vá là bản nào.
  - Lỗi đã được vá hết chưa.
  - Đánh giá các biến thể của lỗi vendor đã vá.

- `6.` Kết luận.

  - Đánh giá sơ lược về bug ( lỗi có thể làm được gì, chain với các loại lỗi nào vd adobe sandbox escape, chrome sandbox escape, tích hợp với các malware để tự nâng quyền từ bình thường lên system).

- `7.` Acknowledgement/Reference

  - Tài liệu liên quan bỏ vào đây.

- `8.` Tệp đính kèm.

  - Cung cấp mã khai thác có 3 mức độ

    - Poc tối giản ( hit path poc/ minimal poc).
    - Poc khai thác ( Exploit poc)
    - Optional: Mã khai thác tác chiến (Weaponized exploit (work everytime every where) )

  - Optional: Phân tích biến thể.

  - Reference

## REALWORLD CASE

- Bài này viết về cách mà Trung Quốc phô trương quyền lực trên không gian mạng
  - https://warontherocks.com/2021/10/china-flaunts-its-offensive-cyber-power/
- Để hiểu rõ hơn có 1 số mốc thời gian:
  - 2007: Pwn2Own được tổ chức lần đầu, hacker sẽ được nhận thưởng tiền mặt nếu họ hack thành công các phần mềm do ban tổ chức đưa ra trước.
  - 2014: vài năm liền VUPEN gần như thống trị với việc liên tiếp đánh bại các mục tiêu ở Pwn2Own, sau này founder VUPEN thành lập Zerodium là sàn mua bán lỗ hổng bảo mật lớn nhất thế giới hiện giờ.
  - 2017: từ khoảng 2013 các team TQ bắt đầu soán ngôi cho tới khoảng 2016 chính phủ TQ cấm bán mã khai thác lỗ hổng ra bên ngoài. Và 2017 Tianfu Cup được các tập đoàn lớn nhất TQ bảo trợ thành phiên bản Pwn2Own TQ.
  - Từ 2017 trở đi: sân chơi Pwn2Own Mobile hầu như không còn thấy ai có thể hack thành công Iphone hay Android nữa, thay vào đó họ đem vào các mục tiêu khác 'mềm' hơn như Router, NAS và sau này là TV, và các thiết bị thông minh để 'giải ngân' .
- Ngược lại, Tianfu Cup vô cùng thành công, năm nào hacker TQ cũng hack được Iphone/Android, VMWare ESXi và cả Docker, hầu như không gì có thể chặn họ lại.
- Năm 2020, mã khai thác ở Tianfu Cup được cho là đem đi sử dụng để hack nhóm thiểu số ở Uyghur và bị lên án. 2021 mới cách đây 1 tháng họ cũng hack được mọi thứ trừ Google Pixel(!), có một điều thú vị là 2 lỗi trong số đó đã được báo cáo cho Google và được vá trong bản cập nhật sáng nay, tức là họ báo ngay sau cuộc thi.
- Quay lại bài báo họ cho rằng không như tên lửa xuyên lục địa hay vũ khí hạt nhân có thể đem diễu hành mà không sợ bị mất, mã khai thác khi đã đem lên sàn thi đấu gần như sẽ bị vô hiệu hoá không sớm thì muộn, nhưng TQ vẫn làm như vậy để chứng tỏ năng lực của họ.
  - Windows 10 - hacked 5 times
  - Adobe PDF Reader - 4 times
  - Ubuntu 20 - 4 times
  - Parallels VM - 3 times
  - IOS 15-3 times
  - Apple Safari - 2 times
  - Google Chrome - 2 times
  - ASUS AX56U router - 2 times
  - Docker CE - 1 time
  - VMWare ESXi - 1 time
  - VMWare Workstation - 1 time
  - qemu VM-1 time
  - Microsoft Exchange - 1 time

```bash
- 1. Một nhóm phát triển khai thác.

- 2. Một nhóm nghiên cứu tấn công.

- 3. Một nhóm tiến hành tấn công.

- 4. Một nhóm truy cập từ xa vào các phần mềm lưu trữ mã nguồn.
```

## LEARN PATH

I. Advanced learn Exploit Windows

- 1. Windows Exploit Development Tutorial Series: https://fuzzysecurity.com/tutorials.html
- 2. Occult Windows Hacking: https://fuzzysecurity.com/tutorials.html

II. One-days and RCA Zero-days

1. Chọn 1 CVE để phân tích và trình bày

- Xây dựng môi trường
- Phân tích lỗi
- Phân tích script khai thác
- Trình bày (1-2 tuần 1 lỗ hổng)

2. Nhóm nghiên cứu và phát triển

- a) Phát triển:

  - Phát triển công cụ, giải pháp cho dự án rà soát mã độc.
  - Lên kịch bản, công cụ, tài liệu cho dự án đánh giá EDR.
  - Lên kịch bản, công cụ, tài liệu cho dự án diễn tập tấn công theo kịch bản.
  - [+] Yêu cầu đầu ra: công cụ cho nhóm Threat Hunt sử dụng, kịch bản và tài liệu chi tiết.

- b) Phân tích:

  - Nhận mẫu mã độc từ nhóm Threat Hunt và phân tích.
  - Phân tích các mẫu mới / nổi tiếng.
  - [+] Yêu cầu đầu ra: bản phân tích chi tiết | IOC.

- c) Nghiên cứu

  - Tìm hiểu về các loại lỗ hổng phần mềm.
  - Phân tích và trình bày về các loại lỗ hổng, có thể dựa trên POC.
  - Tìm kiếm CVE, tham gia bug bounty,...
  - [+] Yêu cầu đầu ra: các buổi seminar (trước mắt), CVE (dài hạn).

- d) Đào tạo

  - Đào tạo khóa mới về kiến thức, quy trình, nghiệp vụ.
  - [+] Yêu cầu đầu ra: truyền tải đủ kỹ năng và kiến thức cần thiết để có thể cơ bản tham gia các loại dự án.

- e) Đảm nhiệm chính về content, seminar, blog,...

  - Nhóm thực tập Đào tạo
  - Tham gia đào tạo theo lộ trình có sẵn về hệ điều hành, mã độc, threat hunting,...
